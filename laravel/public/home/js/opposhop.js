function isMobile(){return/(ipad|iphone|ipod|android)/.test(navigator.userAgent.toLowerCase())}function feedback(){document.querySelector(".fly-feedback")&&(document.querySelector(".fly-feedback").style.display="block");var e=!1;$("#overlay-feedback").size()||$("body").append($('<div id="overlay-feedback" />'));$("#overlay-feedback");$("#feedback-button").on("touchstart",function(t){e=!e,$(this).parent().find(".feedback-tooltip")[e?"addClass":"removeClass"]("feedback-active"),$("#overlay-feedback").css("display",e?"block":"none"),$("html")[e?"addClass":"removeClass"]("feedback-opened"),t.preventDefault()}),$("#overlay-feedback").on("touchstart",function(t){$(".fly-feedback").find(".feedback-tooltip")[e?"removeClass":"addClass"]("feedback-active"),$("#overlay-feedback").css("display",e?"none":"block"),$("html")[e?"removeClass":"addClass"]("feedback-opened"),e=!1,t.preventDefault()})}!function(e){e(function(){var t=e("[data-trigger]");t.each(function(){var t=e(this);t.click(function(){var i=t.data("trigger");e("#"+i).click()})}),e(".lazyload").length>0&&e(".lazyload").lazyload({effect:"fadeIn",data_attribute:"src",placeholder:"/assets/images/blank.gif"})})}(jQuery);var OPPO={utils:{},conf:{},controller:{},lang:{must_be_integer:"请输入数字"}};OPPO.controller.CartsController=function(){var e,t=function(e,t){if(e>=0&&t){var i={quantity:e,id:t};$.post("/cart/update",i).done(function(i){$(".error_msg_note").text("");var n=parseInt(i.status,10);if(n>0){var r=$(".cart-product-"+t),s=parseInt(i.data.goods_number);0===e?r.remove():(r.find(".cart-gift-count").html("×"+e),r.find("input.number").val(e),$(".cart-product-quantity-"+t).data("quantity",e)),0===s?($("#shipping_btn").remove(),$(".n-item-cart").html(0),$(".purchase-list").html('<center><h2>购物车空空的，去<a href="/" style="color:#1f8657;">逛逛</a>吧</h2></center>')):$(".n-item-cart").text(s),a()}else $(".error_msg_note").text(i.message)}).fail(function(){$(".error_msg_note").text("系统异常。")})}},i=function(e,t){if(e>=0&&t){var i={id:t};$.post("/cart/remove",i).done(function(i){$(".error_msg_note").text("");var n=parseInt(i.status,10);if(n>0){var r=$(".cart-product-"+t),s=parseInt(i.data.goods_number);0===e&&r.remove(),0===s?($("#shipping_btn").remove(),$(".n-item-cart").html(0),$(".purchase-list").html('<center><h2>购物车空空的，去<a href="/" style="color:#1f8657;">逛逛</a>吧</h2></center>')):$(".n-item-cart").text(s),a()}else $(".error_msg_note").text(i.message)}).fail(function(){$(".error_msg_note").text("系统异常。")})}},a=function(){var e=0,t=0;$(".check-box-item").each(function(){if($(this).hasClass("is-checked")){var i=$(this).data("id");$(".cart-product-quantity-"+i).each(function(){e+=parseInt($(this).data("quantity")),t+=parseFloat($(this).data("price")*$(this).data("quantity"))})}}),$(".total-amount").text(e),$(".total-fee").text("￥"+parseFloat(t).toFixed(2))},n=function(){$(".check-box-all").on("click",function(){$(this).hasClass("is-checked")?$(".check-box-label").removeClass("is-checked"):$(".check-box-label").addClass("is-checked"),a()}),$(".check-box-item").on("click",function(){var e=$(this);if(e.hasClass("is-checked"))e.removeClass("is-checked"),$(".check-box-all").removeClass("is-checked");else{var t=!0;e.addClass("is-checked"),$(".check-box-item").each(function(){$(this).hasClass("is-checked")||(t=!1)}),t&&$(".check-box-all").addClass("is-checked")}a()})},r=$(".purchase-list"),s=".minus",o=".plus",c=".cart-product-delete",d=$("#dialog-confirm"),l=$("#dialog-error-msg"),u=$("#dialog-error-msg .dialog-title-common"),f=$("#dialog-error-msg .button-one-whole"),m=$("#dialog-confirm .button-one"),p=$("#dialog-confirm .button-two"),v=$(".cart-gift-sku li"),h=$("#shipping_btn"),b=$("#shipping_btn_m");return{index:function(){return n(),v.on("click",function(){var e=$(this);if(e.hasClass("active"))return!1;var t=e.data("goods-id"),i=e.data("spu-id"),a=e.data("gift-id"),n=e.data("gift-name"),r=e.data("gift-img"),s=e.data("cart-id");if($(".cart-product-"+s).hasClass("cart-expired"))return!1;if(e.hasClass("cart-expired"))return u.html("该赠品已失效不能选择。").css({color:"#f00"}),l.removeClass("hidden"),!1;var o=OPPO.conf.BASE_URL+"/cart/update/attribute/"+e.data("cart-id"),c={goods_id:t,attr_spu:i,attr_sku:a,type:1};$.post(o,c,function(t){if(!ajaxIsLogin(t))return!1;var i=parseInt(t.status,10);i>0?(e.addClass("active").siblings("li").removeClass("active"),e.parent("ul").prev(".heading").find("a").attr("href",OPPO.conf.BASE_URL+"/products/"+a).html(n),e.parent("ul").parent().parent().parent().find(".cart-gift-image").attr("href",OPPO.conf.BASE_URL+"/products/"+a).find("img").attr("src",r)):$(".error_msg_note").text(t.message)})}),r.off("click",s).on("click",s,function(){var e=$(this).siblings("input").val(),i=$(this).attr("data-id");return $(".cart-product-"+i).hasClass("cart-expired")?!1:2>e?!1:(e--,t(e,i),void 0)}),r.off("click",o).on("click",o,function(){var e=$(this).siblings("input").val(),i=$(this).attr("data-id");return $(".cart-product-"+i).hasClass("cart-expired")?!1:e>=10?($(".error_msg_note").text("商品单次购买上限为10，请重新选择购买数量"),!1):(e++,t(e,i),void 0)}),r.off("click",c).on("click",c,function(){d.removeClass("hidden"),d.find("#product-id").remove(),d.append('<input type="hidden" id="product-id" data-id="'+$(this).attr("data-id")+'"/>')}),m.on("click",function(e){e.preventDefault();var t=d.find("#product-id").data("id"),a=0;t&&i(a,t),d.addClass("hidden")}),p.on("click",function(){d.addClass("hidden")}),f.on("click",function(){l.addClass("hidden")}),h.on("click",function(){OPPO.submit.isSubmit||vm.goToShipping("/trade")}),b.on("click",function(){OPPO.submit.isSubmit||vm.goToShipping("/trade")}),{goToShipping:function(t){var i=[],a=$(".check-box-item");return a.each(function(){$(this).hasClass("is-checked")&&i.push($(this).data("id"))}),i.length<=0?(u.html("购物车无可购买商品,请重新添加商品至购物车。").css({color:"#f00"}),l.removeClass("hidden"),!1):(OPPO.submit.isSubmit=!0,OPPO.submit.change(h,"提交中"),$(".error_msg_note").text(""),u.html(""),e=$.ajax({url:OPPO.conf.BASE_URL+"/cart/count",type:"POST",data:{id:i},dataType:"json",timeout:1e4}).done(function(e){if(!ajaxIsLogin(e))return!1;var i=parseInt(e.status,10);if(i>0){{parseInt(e.data)}window.location.href=t}else u.html(e.message).css({color:"#f00"}),l.removeClass("hidden"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(h,"结算")}).fail(function(){u.html("系统异常，请稍后再试。").css({color:"#f00"}),l.removeClass("hidden"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(h,"结算")}).always(function(t,i){"timeout"===i&&e.abort()}),void 0)}}}}},$(function(){$.each($(".lt-ie9 input[type=text],.lt-ie9 textarea"),function(e,t){var i=$(t).attr("placeholder"),a=$(t).val();return"undefined"==typeof i||""==i||""!=a?!1:($(t).val(i),$(t).on("focus",function(){var e=$(this).val();e==i&&$(this).val("")}),$(t).on("blur",function(){var e=$(this).val();""==e&&$(this).val(i)}),void 0)})}),OPPO.controller.CompareController=function(){var e=function(){var e=$("#compare-box");$("body").on("click","#compare-box .compare-box-mobile",function(){if($(this).hasClass("is-disabled"))return!1;$(this).hasClass("is-selected")?$(this).removeClass("is-selected"):$(this).addClass("is-selected");var t=e.find(".compare-box-mobile"),i=e.find(".is-selected"),a=e.find(".is-disabled"),n=$("#compare-btn button"),r=$("#compare-btn-tip"),s=i.length;return s>=4?t.not(".is-selected").addClass("is-disabled"):a.removeClass("is-disabled"),s>=1?(r.show().find("span").html(s),s>1?n.removeClass("is-disabled"):n.addClass("is-disabled")):r.hide().find("span").html(0),!1})},t=function(){$("body").on("click","#compare-btn button",function(){if($(this).hasClass("is-disabled"))return $(".compare-top-tip").css({color:"red"}),!1;var e=$("#compare-box").find(".is-selected"),t=OPPO.conf.BASE_URL+"/compare/details?id=";$.each(e,function(e,i){var a=$(i).find("input[name=spuId]").val();t+=0==e?a:","+a}),window.location.href=t})},i=function(){$("body").on("click",".compare-panel-title",function(){$(this).hasClass("open")?$(this).removeClass("open"):$(this).addClass("open");var e=$(this).parent().find(".compare-panel-content");e.hasClass("open")?e.removeClass("open"):e.addClass("open")})},a=function(){$("body").on("click",".btn-compare-different",function(){return $(".btn-compare-different").hasClass("open")?$("tr.compare-params.different").hasClass("notdifferent")?($("tr.compare-params.different").removeClass("notdifferent"),$(".btn-compare-different").html("取消高亮")):($("tr.compare-params.different").addClass("notdifferent"),$(".btn-compare-different").html("高亮不同项")):($(".btn-compare-different").addClass("open"),$(".btn-compare-different").html("取消高亮"),$.each($("tr.compare-params"),function(e,t){$.each($(t).find("td.compare-param"),function(e,i){var a="",n=!1;$.each($(i).find(".compare-panel-content span"),function(e,t){0==e?a=$(t).html():a!=$(t).html()&&(n=!0)}),n&&$(t).addClass("different")})})),!1}),$(".compare-box").append('<div class="compare-fixed"><div class="wrapper"><table class="compare-table"></table></div></div>'),$("table.compare-table").find("tr").eq(0).clone().appendTo(".compare-fixed .wrapper table").find(".btn-compare-different").addClass("button-light"),$("body").on("click",".compare-price a.button",function(){return $(this).hasClass("active")?!1:($(this).parent().find("a.active").removeClass("active"),$(this).addClass("active"),$(this).parent().find("span").html("￥"+$(this).data("price")),!1)}),$(window).scroll(function(){var e=$(window).scrollTop(),t=$(".compare-group").eq(0).offset().top;e>t?$(".compare-fixed").slideDown(300):$(".compare-fixed").slideUp(300)})};return{index:function(){return e(),t(),{}},details:function(){return i(),a(),{}}}},$(function(){$("#footer-wx").hover(function(){$(this).find(".wx-float").show()},function(){$(this).find(".wx-float").hide()}),$("body").on("click","#footer-wx",function(){return!1}),$("body").on("mouseenter","#btn-qr",function(){$("#qr-code").show()}),$("body").on("mouseleave","#btn-qr",function(){$("#qr-code").hide()}),$("body").on("click",".footer-sitemap .js-toggle-sitemap",function(){return $(this).hasClass("active")?$(this).removeClass("active").parent().find("ul").hide():($(".footer-sitemap .js-toggle-sitemap").each(function(){$(this).hasClass("active")&&$(this).removeClass("active").parent().find("ul").hide()}),$(this).addClass("active").parent().find("ul").show()),!1}),isMobile()&&feedback()}),OPPO.controller.OrdersController=function(){var e=$("#dialog-confirm"),t=$("#dialog-confirm .button-one"),i=$("#dialog-confirm .button-two"),a=($(".order-history a"),function(t){e.removeClass("hidden"),e.find("#cancel-order-id").remove(),e.append('<input type="hidden" id="cancel-order-id" data-id="'+t+'"/>')}),n=function(){var t=e.find("#cancel-order-id").data("id");if(!t)return alert("订单号不存在"),void 0;var i=OPPO.conf.BASE_URL+"/orders/"+t;$.ajax({type:"DELETE",url:i}).success(function(e){if(!ajaxIsLogin(e))return!1;var t=parseInt(e.status,10);t>0?window.location.reload():alert(e.message)}).error(function(){alert("系统异常。")})};t.on("click",function(t){t.preventDefault(),n(),e.addClass("hidden")}),i.on("click",function(){e.addClass("hidden")});var r,s,o=function(){$("#waybill-view").on("click",function(){if($(this).hasClass("slideDown"))$(this).removeClass("slideDown"),$("#waybill-status").slideUp(300);else{$(this).addClass("slideDown");var e=$("#waybill-status").html();if(""!=e)$("#waybill-status").slideDown(300);else{$("#waybill-waiting").show();var t=$(this).attr("href");$.ajax({url:t,type:"get",dataType:"json",success:function(e){var t="";e.status<0?t=e.message:$.each(e.message,function(e,i){t+="<p><span>"+i.time+"</span> "+i.status+"</p>"}),$("#waybill-waiting").hide(),$("#waybill-status").html(t).slideDown(300).next(".kuaidi100").show()},error:function(){$("#waybill-waiting").hide(),$("#waybill-status").html("获取物流状态超时").slideDown(300)}})}}return!1})},c=function(){$(".js-tab-nav-for-qrpay").click(function(){if(!$(this).hasClass("hasClicked")){$(this).addClass("hasClicked");var e=$(".js-tab-iframe-for-qrpay").find("iframe");$(e).attr("src",$(e).data("src"))}})},d=$(".error_msg_note"),l=$("#pay_action"),u=function(e){s=$.ajax({url:"/orders/"+e+"/paystatus",type:"GET",dataType:"json",timeout:1e4}).done(function(t){if(!ajaxIsLogin(t))return!1;var i=parseInt(t.status,10);if(i>0){var a=$("#paymentJumpUrl").attr("href");window.location.href=a}else clearTimeout(r),r=setTimeout(function(){u(e)},3e3)}).fail(function(){clearTimeout(r),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(l,"立即支付")}).always(function(e,t){"timeout"===t&&(s.abort(),d.html("系统异常，请稍后再试。"))})},f=function(){var e=$("#weixin_qrcode");if(240==e.width())return!1;var t=$("#weixin_qrtext"),i=$("input[name=order_sn]").val(),a=e.data("src"),n=new Image;n.src=a,n.onload=function(){e.attr("src",a).width(240).height(240),u(i)},n.onerror=function(){t.html("微信扫码加载失败，请刷新重试"),e.attr("src","")},n.src=e.data("src")},m=function(){if($(".alipay-iframe").find("iframe").length>0){var e=$(".alipay-iframe").find("iframe");""==e.attr("src")&&e.attr("src",e.data("src"))}},p=function(){$(".list-platforms .radio-item").eq(0).show().find(".radio-extend").show().addClass("radio-selected");var e=$(".list-platforms .radio-item").eq(0).find("input.parent_radio").attr("code");"weixin_qrcode"==e?f():"alipay"==e&&m(),$("a.open-platforms").on("click",function(){$(".list-platforms .radio-item span.radio").removeClass("checked_radio"),$(".list-platforms .radio-item input:checked").attr("checked",!1),$(".radio-selected").removeClass("radio-selected").slideUp(300),$(".list-platforms .radio-item").fadeIn(300),$(this).parent().html("&nbsp;"),$(".opr-btn-pay").find(".button").addClass("button-disabled"),"undefined"!=typeof _optj&&_optj.push(["_trackEvent","store","link","order","open_platforms"])}),$("input.parent_radio").on("change",function(){clearTimeout(r),s&&s.abort(),$parent=$(this).parents(".radio-item");{var e=$(this).attr("code");$(this).val()}!$parent.find(".radio-selected").length>0&&($(".radio-selected").length>0&&$(".radio-selected").removeClass("radio-selected").slideUp(300),$parent.find(".radio-extend").length>0&&$parent.find(".radio-extend").addClass("radio-selected").slideDown(300),$("input.bank_radio:checked").attr("checked",!1),$("input.bank_radio").parent().removeClass("checked_radio"),$(".input-big-radio input:checked").attr("checked",!1),$(".input-big-radio span").removeClass("checked_radio"),$(".fenqi_text").hide()),"alipay"==e||"tenpay"==e||"alipay_wap"==e||"weixin_js"==e?($(".opr-btn-pay").find(".button").removeClass("button-disabled"),"alipay"==e&&m()):($(".opr-btn-pay").find(".button").addClass("button-disabled"),"weixin_qrcode"==e&&f())}),$(".input-big-radio input").on("change",function(){$(".fenqi_text").hide();var e=$(this).data("cnt"),t=$(this).data("param2"),i=$(this).data("param3"),a=(t/e).toFixed(2);$(".fenqi_text").find("span:eq(0)").html(e),$(".fenqi_text").find("span:eq(1)").html("￥"+a),$(".fenqi_text").find("span:eq(2)").html(i),$(".fenqi_text").fadeIn(300),$(".opr-btn-pay").find(".button").removeClass("button-disabled")}),$("input.bank_radio").on("change",function(){$(".opr-btn-pay").find(".button").removeClass("button-disabled");$(this).attr("bankcode")}),$(".opr-order-detail a").on("click",function(){$(".opr-order-details").hasClass("open")?($(".opr-order-details").removeClass("open").slideUp(300),$(this).find(".icon").removeClass("icon-arrow-top-green").addClass("icon-arrow-up-green")):($(".opr-order-details").addClass("open").slideDown(300),$(this).find(".icon").removeClass("icon-arrow-up-green").addClass("icon-arrow-top-green"))});var t="{{$is_mobile}}";t&&$(".main-footer").hide()},v=!1,h=function(){var e=$(".coupon-code .alert-danger"),t=$("input[name=coupon-code]"),i=$("input[name=order_sn]"),a=$(".coupon-code-use");a.on("click",function(){var n=$.trim(t.val());if(!n||""===n)return e.html("请输入推荐码。"),!1;if(!OPPO.utils.checkCoupon(n))return e.html("推荐码格式不正确。"),!1;if(v)return!1;v=!0,OPPO.submit.change(a,"提交中"),e.html("");var r=OPPO.conf.BASE_URL+"/orders/addgifts",s=$.ajax({url:r,type:"POST",dataType:"json",data:{voucher_sn:n,serial:i.val()},timeout:1e4}).done(function(i){if(!ajaxIsLogin(i))return!1;var n=parseInt(i.status,10);n>0?(e.html("使用成功，该订单已成功赠送自拍杆一个，请尽快完成支付！"),t.attr("disabled",!0),a.html("立即使用"),a.hide(),clearTimeout(OPPO.submit.timer)):(e.html(i.message),v=!1,OPPO.submit.clearChange(a,"立即使用"))}).fail(function(){e.html("使用失败"),v=!1,OPPO.submit.clearChange(a,"立即使用")}).always(function(t,i){"timeout"===i&&(s.abort(),e.html("系统异常，请稍后再试。"))})})};return{processing:function(){var e=$("input[name=order_serial]").val();if(e){var t=function(e){var i=OPPO.conf.BASE_URL+"/orders/"+e+"/status";$.get(i).success(function(i){if(!ajaxIsLogin(i))return!1;var a=parseInt(i.status,10);if(a>0){var n=OPPO.conf.BASE_URL+"/orders/"+e+("online"==i.data?"/payments":"/confirmation");window.location.href=n}else t(e)}).error(function(){t(e)})};t(e)}},index:function(){return{cancel:function(e){a(e)}}},show:function(){return o(),{cancel:function(e){a(e)}}},payments:function(){function e(){var e=$("input[type=radio][name=payonline_category]:checked"),t=$("input[name=order_sn]"),i=$("input[name=payment_code]"),a=$("input[name=payment_bankcode]"),n=$("input[name=payment_method]"),o=$("input[name=payment_qr_pay]"),c=$("input[name=short_pay]"),f=$("input[name=payonline_bank]:checked"),m=$("input[name=payonline_installment]:checked"),p=0!==e.length;if(d.html(""),!p)return d.html("请选择付款方式"),!1;if("wangyin"==e.val()&&!f.length>0)return d.html("请选择具体的银行网银支付"),!1;if("weixin_qrcode"==e.val()&&!f.length>0)return d.html("请选择使用微信扫码支付"),!1;if("installment"==e.val()&&!m.length>0)return d.html("请选择具体的分期支付方式"),!1;if(OPPO.submit.isSubmit)return!1;if(t.val()){OPPO.submit.isSubmit=!0,OPPO.submit.change(l,"支付中");var v=e.attr("code"),h=e.val();if("installment"===h){var b=m.attr("data-cnt"),P=$(".installment_str_"+b).val();$("#Request").val(P),$("#installment_payment_form").submit()}else if("wangyin"===h){var v=f.attr("code"),O=f.attr("bankcode"),g=f.attr("paymethod"),_=f.attr("kuaijiezhifu")?f.attr("kuaijiezhifu"):"0",k=f.attr("qr_pay")?f.attr("qr_pay"):"0";i.val(v),a.val(O),n.val(g),o.val(k),c.val(_),$("#payment_form").submit()}else{var O=e.attr("bankcode"),g=e.attr("paymethod"),_=e.attr("kuaijiezhifu")?e.attr("kuaijiezhifu"):"0",k=e.attr("qr_pay")?e.attr("qr_pay"):"0";i.val(v),a.val(O),n.val(g),o.val(k),c.val(_),$("#payment_form").submit()}$("#dialog").removeClass("hidden"),clearTimeout(r),s&&s.abort(),r=setTimeout(function(){u(t.val())},3e3)}else d.html("操作异常，请重试")}c(),p(),h(),$(".dialog-close").click(function(){clearTimeout(r),$("#dialog").addClass("hidden"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(l,"立即支付"),s&&s.abort()}),$("#failed_to_pay").click(function(){clearTimeout(r),$("#dialog").addClass("hidden"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(l,"立即支付"),s&&s.abort()}),l.click(e);var t=$("a.huabei-pay");t.click(e)}}},OPPO.controller.ProductsController=function(){var e=$("#button-buy"),t=$("#go-buy");e.on("click",function(e){e.preventDefault(),OPPO.submit.isSubmit||vm.addToCart(!1,0,Yo.config.product_id)}),t.on("click",function(e){e.preventDefault(),OPPO.submit.isSubmit||vm.addToCart(!1,0,Yo.config.product_id,!0)});var i=function(i,a,n){OPPO.submit.isSubmit=!0,n?OPPO.submit.change(t,"提交中"):OPPO.submit.change(e,"提交中");var r=OPPO.conf.BASE_URL+"/cart/insert",s=$.ajax({url:r,type:"POST",timeout:5e3,data:i}).done(function(i){var r=parseInt(i.status,10);if(r>0){var s="";n?100===r&&(s=i.message,window.location.href=s):(s=a?OPPO.conf.BASE_URL+"/trade":i.data.url,window.location.href=s)}else-100===r?(OPPO.submit.isSubmit=!1,n?OPPO.submit.clearChange(t,"立即购买"):OPPO.submit.clearChange(e,"加入购物车"),oppo.win.open(i.data.url)):($(".buying-actions").next(".alert-danger").remove(),$(".buying-actions").after('<div class="row alert-danger">'+i.message+"</div>"),OPPO.submit.isSubmit=!1,n?OPPO.submit.clearChange(t,"立即购买"):OPPO.submit.clearChange(e,"加入购物车"))}).fail(function(){OPPO.submit.isSubmit=!1,n?OPPO.submit.clearChange(t,"立即购买"):OPPO.submit.clearChange(e,"加入购物车")}).always(function(e,t){"timeout"===t&&s.abort()})},a=$("#button-quick-buy");a.on("click",function(e){e.preventDefault(),OPPO.submit.isSubmit||C()});var n,r=function(){if(!is_insurance_allowed)return!1;var e=Yo.config.product_id,t=OPPO.conf.BASE_URL+"/products/service/insurance/"+e,i=$.ajax({url:t,type:"GET",dataType:"json",timeout:5e3}).done(function(e){if(e){var t=parseInt(e.status);t>0&&o(e.data)}}).fail(function(){}).always(function(e,t){"timeout"===t&&i.abort()})},s=function(e){switch(parseInt(e)){case 6:return"半";case 12:return"一"}},o=function(e){if(e){var e=JSON.parse(e);if(e.services){var t='<div class="one-quarter desk-one-fifth"><div class="y-label">服务</div></div><div class="gi three-quarters desk-four-fifths">';if(e.services.repair){var i=e.services.repair;t+='<div class="g pro-service-defer">';for(var a=0;a<i.length;a++)i[a].promoted_fee<i[a].fee?(t+='<a class="gi pro-service-tab service-repair tab-promotion" data-ttl="'+i[a].ttl+'">',t+=' <span class="service-flag-defer">延</span>',t+=" <span>延保"+s(i[a].ttl)+'年 <font class="promoted">￥'+i[a].promoted_fee+'&nbsp;&nbsp;</font><font class="normal">￥'+i[a].fee+"</font></span>",t+="</a>"):(t+='<a class="gi pro-service-tab service-repair tab-normal" data-ttl="'+i[a].ttl+'">',t+=' <span class="service-flag-defer">延</span>',t+=" <span>延保"+s(i[a].ttl)+"年 ￥"+i[a].fee+"</span>",t+="</a>");t+="</div>"}if(e.services.screen){var n=e.services.screen;t+='<div class="g pro-service-broke">';for(var a=0;a<n.length;a++)n[a].promoted_fee<n[a].fee?(t+='<a class="gi pro-service-tab service-screen tab-promotion" data-ttl="'+n[a].ttl+'">',t+=' <span class="service-flag-broke">碎</span>',t+=" <span>屏碎保"+s(n[a].ttl)+'年 <font class="promoted">￥'+n[a].promoted_fee+'&nbsp;&nbsp;</font><font class="normal">￥'+n[a].fee+"</font></span>",t+="</a>"):(t+='<a class="gi pro-service-tab service-screen tab-normal" data-ttl="'+n[a].ttl+'">',t+=' <span class="service-flag-broke">碎</span>',t+=" <span>屏碎保"+s(n[a].ttl)+"年 ￥"+n[a].fee+"</span>",t+="</a>");t+="</div>"}t+='<div class="pro-service-igree"><P>购买保险服务表示您已同意<a id="service-igree" class="terms">《OPPO保障服务条款》</a><a href="'+OPPO.conf.WWW_URL+'service/guarantee" target="_blank" class="color-primary">了解详情&gt;&gt;</a></P></div>',$(".pro-service").html(t),c(),$(".icon-tab-free-selected").parent().trigger("click")}}},c=function(){var e=$("input[name=service-repair]"),t=$("input[name=service-screen]");$(".service-repair").on("click",function(){var t=$(this);t.hasClass("active")?(t.removeClass("active"),e.val(0)):(t.addClass("active").siblings("a").removeClass("active"),e.val(t.data("ttl")))}),$(".service-screen").on("click",function(){var e=$(this);e.hasClass("active")?(e.removeClass("active"),t.val(0)):(e.addClass("active").siblings("a").removeClass("active"),t.val(e.data("ttl")))}),$("#service-igree").on("click",function(){$("#modal-service").modal()})},d=$("#dialog-userinfo"),l=d.find("input[name=receiver]"),u=d.find("input[name=mobile]"),f=d.find("input[name=address-detail]"),m=d.find("select[name=province_id]"),p=d.find("select[name=city_id]"),v=d.find("select[name=district_id]"),h=d.find("select[name=town_id]"),b=d.find(".error-info"),P=function(){var e=$.trim(l.val()),t=$.trim(u.val()),i=$.trim(f.val()),a=m.find("option:selected").val(),r=p.find("option:selected").val(),s=v.find("option:selected").val(),o=h.find("option:selected").val();if(!e)return b.html("请输入收货人姓名。"),!1;if(OPPO.utils.checkSpec(e))return b.html("收货人姓名不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(e)>OPPO.utils.namelen)return b.html("收货人姓名不能超过"+OPPO.utils.namelen+"个字符。"),!1;if(!t)return b.html("请输入手机号码。"),!1;if(!OPPO.utils.isMobile(t))return b.html("手机号码格式不正确。"),!1;if(!a||-1===parseInt(a))return b.html("请选择省份。"),!1;if(!i)return b.html("请输入详细地址。"),!1;if(OPPO.utils.checkSpec(i))return b.html("详细地址不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(i)>OPPO.utils.addrlen)return b.html("详细地址不能超过"+OPPO.utils.addrlen+"个字符。"),!1;b.html(""),i=OPPO.utils.filtertxt(i,m.find("option:selected").text()),i=OPPO.utils.filtertxt(i,p.find("option:selected").text()),i=OPPO.utils.filtertxt(i,v.find("option:selected").text()),i=OPPO.utils.filtertxt(i,h.find("option:selected").text()),OPPO.submit.isSubmit=!0,OPPO.submit.change(O,"提交中");var c=$(".service-repair"),d=$(".service-screen"),P=$(".tab-selected"),g=0,_=0,k=0,x=$("#amount-textbox").val(),y=OPPO.conf.BASE_URL+"/orders/quickbuyV2";c&&c.each(function(){$(this).hasClass("active")&&(g=$(this).data("ttl"))}),d&&d.each(function(){$(this).hasClass("active")&&(_=$(this).data("ttl"))}),P&&P.each(function(){$(this).hasClass("active")&&(k=$(this).data("goods-attach"))});var C={id:Yo.config.product_id,quantity:x,services:{repair:g,screen:_},goods_attach:k,receiver:e,mobile:t,province_id:a,city_id:r,district_id:s,town_id:o,address_detail:i};$('[name="gift[]"]').length>0&&$('[name="gift[]"]').each(function(e){var t=$(this);C["gifts["+e+"]"]=t.val()}),n=$.ajax({url:y,type:"POST",dataType:"json",timeout:1e4,data:C}).done(function(e){if(!ajaxIsLogin(e))return!1;var t=parseInt(e.status,10);t>0?window.location.href=OPPO.conf.BASE_URL+"/"+e.data:(b.html(e.message),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(O,"提交"))}).fail(function(){OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(O,"提交")}).always(function(e,t){"timeout"===t&&n.abort()})},O=$("#submit-userinfo");O.on("click",function(e){e.preventDefault(),OPPO.submit.isSubmit||P()}),$(".dialog-close").on("click",function(){_(),d.addClass("hidden"),n&&n.abort()});var g,_=function(){l.val(""),u.val(""),f.val(""),b.html(""),d.region({pid:-1,cid:-1,did:-1,tid:-1})},k=0,x=$("#dialog-userinfo .button-change");x.on("click",function(e){e.preventDefault(),b.html(""),k>=g.length-1?k=0:k++,y()});var y=function(){var e=g[k];d.region({pid:e.province_id,cid:e.city_id,did:e.district_id,tid:e.town_id}),l.val(e.receiver),u.val(e.mobile),f.val(e.address)},C=function(){OPPO.submit.isSubmit=!0,OPPO.submit.change(a,"提交中");var e=OPPO.conf.BASE_URL+"/user/addresses/list?f=quickbuy",t=$.ajax({url:e,type:"get",dataType:"json",timeout:8e3}).done(function(e){if(!ajaxIsLogin(e))return!1;OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(a,"立即抢购");var t=parseInt(e.status,10);t>0&&e.data?(d.removeClass("hidden"),g=e.data,k=0,g.length>1&&x.show(),y()):(d.removeClass("hidden"),d.region({pid:-1,cid:-1,did:-1,tid:-1}))}).fail(function(){OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(a,"立即购买"),d.removeClass("hidden"),d.region({pid:-1,cid:-1,did:-1,tid:-1})}).always(function(e,i){$(".buying-actions").next(".alert-danger").remove(),"timeout"===i&&t.abort()})},w=$("#button-notice"),S=$("#button-notice-submit"),I=$("#dialog-notice"),j=$("#dialog-notice-success"),q=$("#dialog-notice-success .count-down"),L=$('#dialog-notice input[name="mobile"]'),T=$("#dialog-notice .alert-danger"),A=function(){w.on("click",function(){I.removeClass("hidden"),L.val(""),T.html(""),S.html("提交")});var e=!1,t=function(){var t=OPPO.conf.BASE_URL+"/products/notice/"+Yo.config.product_id,i=$.trim(L.val());return""===i||null===i?(T.html("请输入手机号码。"),!1):OPPO.utils.isMobile(i)?(e=!0,S.html("提交中..."),$.ajax({url:t,type:"post",dataType:"json",data:{mobile:i}}).done(function(e){if(!ajaxIsLogin(e))return!1;var t=parseInt(e.status,10);t>0?(L.val(""),T.html(""),I.addClass("hidden"),j.removeClass("hidden"),q.html(3),a(3)):T.html(e.message)}).fail(function(e){T.html(e.message)}).always(function(){e=!1,S.html("提交")}),void 0):(T.html("手机号码格式不正确。"),!1)};S.on("click",function(){e||t()});var i,a=function(e){return clearTimeout(i),0>=e?(q.html(3),j.addClass("hidden"),!1):(q.html(e),e--,i=setTimeout(function(){a(e)},1e3),void 0)}},U=function(){var e=$("#good-gifts");e.find(".gift-item").each(function(){var e=$(this),t=e.find(".y-img"),i=e.find(".swatches"),a=e.find("input");i.on("click",".swatch a",function(e){var n=$(this).parent(),r=n.attr("data-gift-id"),s=n.attr("data-thumbnail");if(i.find("li").removeClass("selected"),!n.hasClass("selected")){n.addClass("selected"),a.val(r);var o=$("<img />").attr("src",s);t.html(o)}e.preventDefault()})})},E=$(".pro-packages .tab-selected"),R=function(){E.on("click",function(){$(this).hasClass("active")?($(this).removeClass("active"),a.removeClass("hidden"),$("#button-buy-div").removeClass("hidden")):(E.removeClass("active"),$(this).addClass("active"),$("#button-buy-div").addClass("hidden"),a.removeClass("hidden"))})};return{index:function(){function e(){if($(".navigation-filters").length&&$(window).width()<750){var e=$(".navigation-filters .is-active a").text();$(".navigation-filters .filter-name .current").text(e),$(".navigation-filters .filter-name").on("click",function(){$(this).parent(".navigation-filters").toggleClass("is-open")}),$(".navigation-filters li a").on("click",function(e){e.preventDefault();var t=$(this).parents(".navigation-filters"),i=$(this).parent("li"),a=$(this).text();i.addClass("is-active").siblings("li").removeClass("is-active"),t.find(".filter-name .current").text(a),t.removeClass("is-open"),window.location.href=$(this).attr("href")})}else $(".navigation-filters .filter-name").off(),$(".navigation-filters li a").off()}function t(e){if(e&&e.length){for(var t="",i=e.length>4?4:e.length,a=0;i>a;a++){var n=e[a];href="/products/"+n.id+".html",t+='<div class="box" style="height: 422px;">',t+='<a target="_blank" href="'+href+'">',t+='<div class="box-photo"><img alt="" title="" src="'+n.rpath+'"></div></a>',t+='<h2 class="box-heading"><a target="_blank" href="'+n.href+'" title="">',t+='</a><a target="_blank" href="'+href+'" title="'+n.name+'">'+n.name+"</a></h2>",t+='<div class="box-details">',0==n.is_price_hidden&&(n.promoted?(t+='<p class="box-price box-price-offer">',t+='<span class="normal">￥'+n.price+"</span>",t+='<strong class="reduced">￥'+n.promoted_price+"</strong></p>"):(t+='<p class="box-price">',t+='<span class="normal">&nbsp;</span>',t+="<strong>"+n.price+"</strong></p>")),t+="</div>";var r="";switch(n.new_product){case 1:r="ribbon-new";break;case 2:r="ribbon-promotion";break;case 3:r="ribbon-cheap";break;default:r=""}t+='<i class="ribbon '+r+'"></i>',t+="</div>"}$("#goods_view_history_list").html(t),$("#goods_view_history").show()}}function i(){var e=OPPO.utils.getcookie("view_history");e&&$.ajax({url:"/products/0/visit_history",type:"GET"}).then(function(e){data=e}).done(function(){var e=data.status;"1"==e&&t(data.data)}).fail(function(){})}e(),i(),$(window).resize(function(){e()})},show:function(){return r(),A(),U(),R(),{attrKeys:[],quicklyBuy:function(){C()},addToCart:function(e,t,a,n){var r=$(".service-repair"),s=$(".service-screen"),o=0,c=0,d=$("#amount-textbox").val(),n=n||!1;if(r&&r.each(function(){$(this).hasClass("active")&&(o=$(this).data("ttl"))}),s&&s.each(function(){$(this).hasClass("active")&&(c=$(this).data("ttl"))}),!/^\d+$/.test(d))return alert("请填写购买数量!"),void 0;var l={id:a,quantity:d,type:t,services:{repair:o,screen:c}};n&&(l.quickbuy=1),$('[name="gift[]"]').length>0&&$('[name="gift[]"]').each(function(e){var t=$(this);l["gifts["+e+"]"]=t.val()}),i(l,e,n)}}}}},OPPO.controller.PromotionsController=function(){var e=function(e,t){var i=OPPO.conf.BASE_URL+"/cart/insert";$.post(i,e,function(){var e=OPPO.conf.BASE_URL+(t?"/trade":"/cart");window.location.href=e})};return{show:function(){return $("#promotion-add-cart-form span.radio").each(function(e,t){$(t).off("click")}),{addToCart:function(t,i,a){var n={id:a,quantity:1,type:i};e(n,t)}}}}},OPPO.controller.RegionController=function(){return{pcrselect:function(e){var t={obj:this,pid:0,cid:0,rid:0};if($.extend(t,e),"undefined"==typeof arrCity||arrCity.length<=0)return!1;var i=$(t.obj),a=i.find("select[name=province_id]"),n=i.find("select[name=city_id]"),r=i.find("select[name=district_id]"),s=parseInt(t.pid),o=parseInt(t.cid),c=parseInt(t.rid);if(a.length<=0||n.length<=0||r.length<=0)return!1;var d=function(e){$(e).parent().find(".select_label").html("<span>"+$(e).find("option:selected").text()+"</span>")},l=function(e){r.html(""),$.each(e,function(e,t){var i=parseInt(t.id,10),a=t.name;0===e&&0===c&&(c=i),i!==c?r.append('<option value="'+i+'">'+a+"</option>"):r.append('<option value="'+i+'" selected>'+a+"</option>"),d(r)
})},u=function(e){n.html(""),$.each(e,function(e,t){var i=parseInt(t.id,10),a=t.name,r=t.sub;0===e&&0===o&&(o=i),i!==o?n.append('<option value="'+i+'">'+a+"</option>"):(n.append('<option value="'+i+'" selected>'+a+"</option>"),r.length>0&&-1!==o&&l(r)),d(n)})},f=function(){a.html(""),$.each(arrCity,function(e,t){var i=parseInt(t.id,10),n=t.name,r=t.sub;i!==s?a.append('<option value="'+i+'">'+n+"</option>"):(a.append('<option value="'+i+'" selected>'+n+"</option>"),r.length>0&&u(r)),d(a)})};f(),a.on("change",function(){s=parseInt($(this).val()),o=0,-1!==c&&(c=0),f()}),n.on("change",function(){o=parseInt($(this).val()),-1!==c&&(c=0),f()})}}},OPPO.controller.TradesController=function(){var e,t=($("select[name=province_id]"),$("select[name=city_id]"),$("select[name=district_id]"),$(".error_msg_note")),i=$(".remove-address"),a=$(".address-update"),n=$(".address-cancel"),r=$(".address-store"),s=$(".address-more"),o=$(".address-new-cancel"),c=$("#address_new"),d=$(".address-form-new"),l=$("input[name=voucher]"),u=$(".coupon-code-use"),f=$(".coupon-code-clear"),m=$("input[name=coupon-code]"),p=($(".coupon-more-btn"),$(".coupon-code .alert-danger")),v=$("#update-invoice-btn"),h=$("#save-invoice-title"),b=$("#invoice-new"),P=$("#invoice-title"),O=$("input[name=invoicetitle]"),g=$("input[name=invoice_title]"),_=$("input[name=goods_fee]"),k=$("input[name=shipping_fee]"),x=$("input[name=shipping_id]"),y=$("input[name=discount_fee]"),C=$("input[name=payment_fee]"),w=$("input[name=payment_id]"),S=$("input[name=amount_fee]"),I=$(".cart-button"),j=function(e){return 11===e.length&&!isNaN(e)&&"1"===e.substring(0,1)},q=function(e,t){$(e+" .form-actions").next(".alert-danger").remove(),$(e+" .form-actions").after('<div class="field alert-danger">'+t+"</div>")};return{index:function(){i.click(function(){if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0;var e=$(this).attr("data-id"),i=OPPO.conf.BASE_URL+"/addresses/"+e;$.ajax({type:"delete",url:i}).success(function(e){if(!ajaxIsLogin(e))return!1;var i=parseInt(e.status,10);i>0?window.location.reload():(t.text(e.message),OPPO.submit.isSubmit=!1)}).error(function(){t.text("系统异常。"),OPPO.submit.isSubmit=!1})}),a.click(function(){var e=$(this).attr("data-id"),t="#address-edit-"+e,i=$(t+" input[name=receiver]"),n=$(t+" input[name=mobile]"),r=$(t+" input[name=email]"),s=$(t+" input[name=address-detail]"),o=$(t+" select[name=province_id]"),c=$(t+" select[name=city_id]"),d=$(t+" select[name=district_id]"),l=$(t+" select[name=town_id]"),u=$(t+" input[name=postcode]"),f=$.trim(i.val()),m=$.trim(n.val()),p=$.trim(r.val()),v=$.trim(o.val()),h=$.trim(c.val()),b=$.trim(d.val()),P=$.trim(l.val()),O=$.trim(s.val()),g=$.trim(u.val());if(!f)return q(t,"请输入收货人姓名。"),!1;if(OPPO.utils.strlen(f)>OPPO.utils.namelen)return q(t,"收货人姓名不能超过"+OPPO.utils.namelen+"个字符。"),!1;if(OPPO.utils.checkSpec(f))return q(t,"收货人姓名不能包含【 】 < > & * 这些特殊字符。"),!1;if(!m)return q(t,"请输入手机号码。"),!1;if(!OPPO.utils.isMobile(m))return q(t,"手机号码格式不正确。"),!1;if(!v||-1===parseInt(v))return q(t,"请选择您的收货地址。"),!1;if(!O)return q(t,"请输入详细地址。"),!1;if(OPPO.utils.checkSpec(O))return q(t,"详细地址不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(O)>OPPO.utils.addrlen)return q(t,"详细地址不能超过"+OPPO.utils.addrlen+"个字符。"),!1;if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0,OPPO.submit.change(a,"提交中"),O=OPPO.utils.filtertxt(O,o.find("option:selected").text()),O=OPPO.utils.filtertxt(O,c.find("option:selected").text()),O=OPPO.utils.filtertxt(O,d.find("option:selected").text()),O=OPPO.utils.filtertxt(O,l.find("option:selected").text());var _=OPPO.conf.BASE_URL+"/addresses/"+e,k={receiver:f,mobile:m,email:p?p:"",address:O,province_id:v,city_id:h,district_id:b,town_id:P,postcode:g};$.ajax({type:"PUT",url:_,data:k,success:function(e){if(!ajaxIsLogin(e))return!1;var i=parseInt(e.status,10);i>0?window.location.reload():(q(t,e.message),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(a,"保存"))},error:function(){q(t,"系统异常。"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(a,"保存")}})}),n.on("click",function(e){e.preventDefault();var t=$(this).attr("data-id"),i=$("[data-address-id="+t+"]");i.find(".form-actions").next(".alert-danger").remove(),i.hide();var a=i.next();a.show()}),o.on("click",function(e){e.preventDefault();var t="#address-create",i=$(t+" input[name=receiver]"),a=$(t+" input[name=mobile]"),n=$(t+" input[name=email]"),r=$(t+" input[name=address-detail]"),s=$(t+" input[name=postcode]");i.val(""),a.val(""),n.val(""),r.val(""),s.val(""),$(t+" .form-actions").next(".alert-danger").remove(),$("#address-create").region({pid:-1,cid:-1,did:-1,tid:-1}),$(t).parent().hide()}),c.click(function(){$("#address-create .form-actions").next(".alert-danger").remove(),d.toggle(),$("#address-create").region({pid:-1,cid:-1,did:-1,tid:-1})}),r.click(function(){var e="#address-create",t=$(e+" input[name=receiver]"),i=$(e+" input[name=mobile]"),a=$(e+" input[name=email]"),n=$(e+" input[name=address-detail]"),s=$(e+" select[name=province_id]"),o=$(e+" select[name=city_id]"),c=$(e+" select[name=district_id]"),d=$(e+" select[name=town_id]"),l=$(e+" input[name=postcode]"),u=$(e+" input[name=validation_code]"),f=$.trim(t.val()),m=$.trim(i.val()),p=$.trim(a.val()),v=$.trim(s.val()),h=$.trim(o.val()),b=$.trim(c.val()),P=$.trim(d.val()),O=$.trim(n.val()),g=$.trim(l.val()),_=$.trim(u.val());if(!f)return q(e,"请输入收货人姓名。"),!1;if(OPPO.utils.strlen(f)>OPPO.utils.namelen)return q(e,"收货人姓名不能超过"+OPPO.utils.namelen+"个字符。"),!1;if(OPPO.utils.checkSpec(f))return q(e,"收货人姓名不能包含【 】 < > & * 这些特殊字符。"),!1;if(!m)return q(e,"请输入手机号码。"),!1;if(!OPPO.utils.isMobile(m))return q(e,"手机号码格式不正确。"),!1;if(!v||-1===parseInt(v))return q(e,"请选择您的收货地址。"),!1;if(!O)return q(e,"请输入详细地址。"),!1;if(OPPO.utils.checkSpec(O))return q(e,"详细地址不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(O)>OPPO.utils.addrlen)return q(e,"详细地址不能超过"+OPPO.utils.addrlen+"个字符。"),!1;O=OPPO.utils.filtertxt(O,s.find("option:selected").text()),O=OPPO.utils.filtertxt(O,o.find("option:selected").text()),O=OPPO.utils.filtertxt(O,c.find("option:selected").text()),O=OPPO.utils.filtertxt(O,d.find("option:selected").text());var k={receiver:f,mobile:m,email:p?p:"",address:O,province_id:v,city_id:h,district_id:b,town_id:P,postcode:g},x=function(){if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0,OPPO.submit.change(r,"提交中");var t=OPPO.conf.BASE_URL+"/addresses";$.post(t,k).success(function(t){if(!ajaxIsLogin(t))return!1;var i=parseInt(t.status,10);i>0?window.location.reload():(q(e,t.message),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(r,"保存"))}).error(function(){q(e,"系统异常。"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(r,"保存")})};if(_){k.activation_code=_;var y=OPPO.conf.BASE_URL+"/auth/direct_register";$.post(y,{user:m,code:_}).success(function(){x()}).error(function(){q(e,"系统异常。")})}else x()}),s.on("click",function(){s.hide(),$(".address-form-item").show()});var L,T=function(e){var t=parseInt(e),i="手机专用";switch(t){case 1:i="手机专用";break;case 2:i="配件专用";break;case 3:i="手机/配件通用"}return i},A=function(e,t){$("#discount_fee_price").text("- ￥"+parseFloat(e).toFixed(2)),y.val(parseFloat(e).toFixed(2)),M(),l.val(t)},U=function(e){var t=OPPO.conf.BASE_URL+"/coupons/available";L=$.get(t,function(t){if(!ajaxIsLogin(t))return!1;var i=parseInt(t.status,10);if(i>0){if(!t.data)return;e?R(t.data):E(t.data)}})},E=function(e){if(e.available&&e.available.length>0){for(var t="",i=0;i<e.available.length;i++){var a=e.available[i].coupon_code;t+=i>4?'<div class="g g-hide">':'<div class="g">',t+=' <div class="gi one-third desk-one-quarter">',t+='  <div class="radio-item radio-item-coupon-list">',t+=0===i?'    <input id="coupon-list-'+i+'" name="coupon-list" type="radio" value="'+a.discount_fee+'" data-code="'+a.c_code+'" checked>':'    <input id="coupon-list-'+i+'" name="coupon-list" type="radio" value="'+a.discount_fee+'" data-code="'+a.c_code+'">',t+='    <label for="coupon-list-'+i+'">'+a.discount_fee+"元</label>",t+="  </div>",t+=" </div>",t+=' <div class="gi one-third desk-one-quarter break-all">'+T(a.c_type)+"（满"+a.limit_fee+"可用）</div>",t+=' <div class="gi one-third desk-two-quarters break-all">'+a.c_starttime+" - "+a.c_endtime+"</div>",t+="</div>",i>4&&i===e.available.length-1&&(t+='<div class="coupon-more">',t+='<a class="coupon-more-btn">展开查看更多可用优惠券<span class="icon icon-arrow-light-down"></span></a>',t+="</div>")}$(".coupon-tabs-content .js-tab").eq(0).html(t);{$("input[name=coupon-list]").custom_form({responsive_select:!0})}if($("input[name=coupon-list]:checked")){var n=$("input[name=coupon-list]:checked");A(n.val(),n.data("code"))}$("input[name=coupon-list]").change(function(){A($(this).val(),$(this).data("code"))})}else $(".coupon-tabs-content .js-tab").eq(0).html('<div class="coupon-none">您暂时还没有可用优惠券哦。</div>');if(e.unavailable&&e.unavailable.length>0){for(var t="",i=0;i<e.unavailable.length;i++){var a=e.unavailable[i].coupon_code;t+=i>4?'<div class="g g-hide">':'<div class="g">',t+=' <div class="gi one-third desk-one-quarter"><span class="space-ml-50">'+a.discount_fee+"元</span></div>",t+=' <div class="gi one-third desk-one-quarter break-all">'+T(a.c_type)+"（满"+a.limit_fee+"可用）</div>",t+=' <div class="gi one-third desk-two-quarters break-all">'+a.c_starttime+" - "+a.c_endtime+"</div>",t+="</div>",i>4&&i===e.unavailable.length-1&&(t+='<div class="coupon-more">',t+='<a class="coupon-more-btn">展开查看更多可用优惠券<span class="icon icon-arrow-light-down"></span></a>',t+="</div>")}$(".coupon-tabs-content .js-tab").eq(1).html(t)}else $(".coupon-tabs-content .js-tab").eq(1).html('<div class="coupon-none">您暂时还没有不可用优惠券哦。</div>');$(".coupon-more-btn").on("click",function(){var e=$(this).parent().siblings(".g");$(this).hasClass("active")?e.each(function(e,t){5>e?$(t).show(200):$(t).hide(200)}):e.show(200),$(this).toggleClass("active")})},R=function(e){var t="";if(void 0!=e.length&&0===e.length)t+="<div>您暂时还没有可用优惠券哦。</div>";else{if(t+='<div class="content-coupon-list">',e.available&&e.available.length>0)for(var i=0;i<e.available.length;i++){var a=e.available[i].coupon_code;t+='<div class="g">',t+=' <div class="gi one-third">',t+='   <div class="radio-item radio-item-coupon-list">',t+=0===i?'     <input id="coupon-list-'+i+'" name="coupon-list-m" type="radio" value="'+a.discount_fee+'" data-code="'+a.c_code+'" checked>':'     <input id="coupon-list-'+i+'" name="coupon-list-m" type="radio" value="'+a.discount_fee+'" data-code="'+a.c_code+'">',t+='     <label for="coupon-list-'+i+'">'+a.discount_fee+"元</label>",t+="   </div>",t+=" </div>",t+=' <div class="gi two-thirds">',t+='   <p class="break-all"><strong>'+T(a.c_type)+"（满"+a.limit_fee+"可用）</strong></p>",t+='   <p class="break-all">'+a.c_starttime+" - "+a.c_endtime+"</p>",t+=" </div>",t+="</div>"}if(e.unavailable&&e.unavailable.length>0)for(var i=0;i<e.unavailable.length;i++){var a=e.unavailable[i].coupon_code;t+='<div class="g unavailable">',t+=' <div class="gi one-third">',t+='   <span class="space-ml-30">'+a.discount_fee+"元</span>",t+=" </div>",t+=' <div class="gi two-thirds">',t+='   <p class="break-all">'+T(a.c_type)+"（满"+a.limit_fee+"可用）</p>",t+='   <p class="break-all">'+a.c_starttime+" - "+a.c_endtime+"</p>",t+=" </div>",t+="</div>"}t+="</div>",e.available&&e.available.length>0&&(t+='<div class="g"><div class="alert-danger"></div><a class="button conform-btn">确认</a></div>')}$("#dialog-coupon-voucher .dialog-content").html(t);var n=.6*$(window).height(),r=$("#dialog-coupon-voucher .content-coupon-list");r.height()>n&&r.css({"max-height":n,"padding-right":"10px","overflow-y":"scroll"});$("input[name=coupon-list-m]").custom_form({responsive_select:!0});if($("input[name=coupon-list-m]:checked")){$("input[name=coupon-list-m]:checked")}$("#dialog-coupon-voucher .conform-btn").on("click",function(e){e.preventDefault();var t=$("input[name=coupon-list-m]:checked");return t.length?($("#dialog-coupon-voucher .alert-danger").html(""),$(".coupon-choice-1").html('已使用1张，优惠<i class="color-red">￥'+t.val()+"元</i>"),$(".coupon-choice-2").html(""),A(t.val(),t.data("code")),$("#dialog-coupon-voucher").addClass("hidden"),void 0):($("#dialog-coupon-voucher .alert-danger").html("请选择可使用优惠券"),!1)})};$("input[name=coupon-type]").change(function(){A("0.00",""),L&&L.abort(),"1"===$(this).val()?($(".coupon-code").hide(),$(".coupon-tabs").show(),$(".js-tabs-nav a").eq(0).trigger("click"),$(".coupon-tabs-content .js-tab").eq(0).html('<div class="coupon-none">玩命加载中。。。</div>'),U(!1)):($(".coupon-tabs").hide(),$(".coupon-code").show(),$(".coupon-code-result").find("span").text(""),$(".coupon-code-result").hide(),$(".coupon-code-field").show(),p.html(""),m.val(""))}),u.click(function(){var e=$.trim(m.val());if(p.html(""),!e||""===e)return p.html("请输入优惠码。"),!1;if(!OPPO.utils.checkCoupon(e))return p.html("优惠码格式不正确。"),!1;var t=OPPO.conf.BASE_URL+"/coupons/usecoupons/"+e,i=$(".coupon-code-field"),a=$(".coupon-code-result");$.get(t,{type:2},function(t){if(!ajaxIsLogin(t))return!1;var n=parseInt(t.status,10);n>0?(p.html(""),m.val(""),i.hide(),a.show().find("span").text(t.data),A(t.data,e)):p.html(t.message)})}),f.on("click",function(){m.val(""),$(".coupon-code .alert-danger").html("")});var B=$(".coupon-choice-voucher"),D=$(".coupon-choice-code"),F=$("input[name=coupon-code-m]"),z=$("#dialog-coupon-code .use-btn");B.on("click",function(e){e.preventDefault(),$("#dialog-coupon-voucher").removeClass("hidden"),$("#dialog-coupon-voucher .dialog-content").html("玩命加载中。。。"),U(!0)}),D.on("click",function(e){e.preventDefault(),$("#dialog-coupon-code").removeClass("hidden"),F.val("")}),z.on("click",function(e){e.preventDefault();var t=$.trim(F.val()),i=$("#dialog-coupon-code .alert-danger");if(i.html(""),!t||""===t)return i.html("请输入优惠码。"),!1;if(!OPPO.utils.checkCoupon(t))return i.html("优惠码格式不正确。"),!1;var a=OPPO.conf.BASE_URL+"/coupons/usecoupons/"+t;$.get(a,{type:2},function(e){if(!ajaxIsLogin(e))return!1;var a=parseInt(e.status,10);a>0?($("#dialog-coupon-code").addClass("hidden"),$(".coupon-choice-1").html(""),$(".coupon-choice-2").html('优惠<i class="color-red">￥'+e.data+"元</i>"),A(e.data,t)):i.html(e.message)})}),$(".dialog-close").on("click",function(e){e.preventDefault(),F.val(""),$("#dialog-coupon-code .alert-danger").html(""),$(this).parent().parent().parent().addClass("hidden")}),P.html($(".address_list_0 .title").html()),g.val($(".address_list_0 .title").html()),v.click(function(e){e.preventDefault(),v.hide(),b.toggle(),O.val(g.val())}),h.click(function(){var e=$.trim(O.val());e&&""!==e&&(P.html(e),g.val(e)),b.hide(),v.show()});var M=function(){var e=parseFloat(_.val())+parseFloat(k.val())+parseFloat(C.val())-parseFloat(y.val()),t=$("#amount_fee_price");t.text("￥"+parseFloat(e).toFixed(2)),S.val(""+e)},N=!1,Y=function(){var e=$("input[name=address]:checked"),t=e.val(),i=$("input[name=goods_fee]").val(),a=OPPO.conf.BASE_URL+"/user/shunfengs/"+t,n={fee:i,user_address_id:t};N=!1,$.get(a,n).success(function(e){if(!ajaxIsLogin(e))return!1;var t=parseInt(e.status,10);if(t>0){var i=JSON.parse(e.data),a=$("input[name=payment_method_radio]");a.removeAttr("checked"),a.eq(0).attr("checked"),a.parent().removeClass("checked_radio"),a.parent().eq(0).addClass("checked_radio"),w.val(0),i.length>1&&$(".payment_method_cod").show();for(var n=parseFloat(0).toFixed(2),r=parseFloat(0).toFixed(2),s=0;s<i.length;s++){var o=i[s];$("#payment_method_radio"+o.payment_id).data("fee",o.payment_fee),$("#payment_method_radio"+o.payment_id).data("shipping_fee",o.shipping_fee),$("#payment_method_radio"+o.payment_id).data("shipping_id",o.shipping_id)}n=parseFloat(i[0].shipping_fee).toFixed(2),x.val(i[0].shipping_id),k.val(""+n),$("#shipping_fee_price").text("+ ￥"+n),C.val(r),$("#payment_fee_price").text("+ ￥"+r),M(),$(".error_msg_note").next(".error_msg_ajax").remove(),N=!0}else $(".error_msg_note").next(".error_msg_ajax").remove(),$(".error_msg_note").after("<strong class='error_msg_ajax'>"+e.message+"</div>")}).error(function(){$(".error_msg_note").text("系统异常。")})};$("input[name=address]").length>0&&Y(),$("input[name=address]").change(function(){$(".payment_method_cod").hide(),Y(),$(".fee-list-payment").hide();var e=$(this).attr("id");$("label").each(function(){$(this).attr("for")===e&&(P.html($(this).find(".title").html()),g.val($(this).find(".title").html()))})}),$("input[name=payment_method_radio]").change(function(){w.val($(this).val());var e=parseFloat($(this).data("fee")),t=parseFloat($(this).data("shipping_fee"));x.val($(this).data("shipping_id")),C.val(e),k.val(t),$("#shipping_fee_price").text("+ ￥"+t.toFixed(2)),4===parseInt($(this).val())?($(".fee-list-payment").show(),$("#payment_fee_price").text("+ ￥"+e.toFixed(2))):$(".fee-list-payment").hide(),M()});var Z=$("#get-validation-code"),G=60,J=function(){0===G?(Z.val("获取验证码").attr("disabled","false"),G=60):(Z.attr("disabled","true").val(G+"秒后重新获取"),G--,setTimeout(function(){J()},1e3))};return I.on("click",function(){OPPO.submit.isSubmit||vm.goToCreateOrder()}),{edit:function(e){if(OPPO.submit.isSubmit)return!1;var t=$("[data-address-id="+e+"]");t.show(),t.find(".form-actions").next(".alert-danger").remove();var i=t.next();i.hide();var a=i.find(".address-form-receiver").val(),n=i.find(".address-form-mobile").val(),r=i.find(".address-form-email").val(),s=i.find(".address-form-address").val();$("#address-edit-"+e+" input[name=receiver]").val(a),$("#address-edit-"+e+" input[name=mobile]").val(n),$("#address-edit-"+e+" input[name=address-detail]").val(s),$("#address-edit-"+e+" input[name=email]").val(r);var o=$("#address-edit-"+e+" select[name=province_id]").data("region-default"),c=$("#address-edit-"+e+" select[name=city_id]").data("region-default"),d=$("#address-edit-"+e+" select[name=district_id]").data("region-default"),l=$("#address-edit-"+e+" select[name=town_id]").data("region-default");return $("#address-edit-"+e).region({pid:parseInt(o),cid:parseInt(c),did:parseInt(d),tid:parseInt(l)}),!1},getValidateCode:function(){var e=$.trim($("#address-create input[name=mobile]").val());if(e&&j(e)){var i=OPPO.conf.BASE_URL+"/auth/sendActivationCode";$.post(i,{phone:e}).success(function(){J()}).error(function(e){t.text(e.responseText)})}else t.text("请输入正确的电话号码");return!1},goToCreateOrder:function(){var i=$("input[name=address]:checked").length;if(!i)return scrollToTop(500),t.text("请选择您的收货地址"),!1;if(!N)return!1;OPPO.submit.isSubmit=!0,OPPO.submit.change(I,"提交中");var a=OPPO.conf.BASE_URL+"/orders/create",n=$("#order-create-form").serializeArray();return e=$.ajax({url:a,type:"POST",dataType:"json",data:n,timeout:1e4}).done(function(e){if(!ajaxIsLogin(e))return!1;var i=parseInt(e.status,10);if(i>0){var a=OPPO.conf.BASE_URL+"/"+e.data;window.location.href=a}else t.text(e.message),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(I,"提交订单")}).fail(function(){t.text("系统异常，请稍后再试。"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(I,"提交订单")}).always(function(t,i){"timeout"===i&&e.abort()}),!1}}}}},OPPO.controller.AddressesController=function(){var e=($("select[name=province_id]"),$("select[name=city_id]"),$("select[name=district_id]"),$(".error_msg_note")),t=$(".address-update"),i=$(".address-cancel"),a=$(".address-store"),n=$(".address-more"),r=$(".address-new-cancel"),s=$("#address_new"),o=$(".address-form-new"),c=$(".remove-address"),d=function(e,t){$(e+" .form-actions").next(".alert-danger").remove(),$(e+" .form-actions").after('<div class="field alert-danger">'+t+"</div>")};return{index:function(){return c.click(function(){if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0;var t=$(this).attr("data-id"),i=OPPO.conf.BASE_URL+"/addresses/"+t;$.ajax({type:"delete",url:i}).success(function(t){if(!ajaxIsLogin(t))return!1;var i=parseInt(t.status,10);i>0?window.location.reload():(e.text(t.message),OPPO.submit.isSubmit=!1)}).error(function(){e.text("系统异常。"),OPPO.submit.isSubmit=!1})}),t.click(function(){var e=$(this).attr("data-id"),i="#address-edit-"+e,a=$(i+" input[name=receiver]"),n=$(i+" input[name=mobile]"),r=$(i+" input[name=email]"),s=$(i+" input[name=address-detail]"),o=$(i+" select[name=province_id]"),c=$(i+" select[name=city_id]"),l=$(i+" select[name=district_id]"),u=$(i+" select[name=town_id]"),f=$(i+" input[name=postcode]"),m=$.trim(a.val()),p=$.trim(n.val()),v=$.trim(r.val()),h=$.trim(o.val()),b=$.trim(c.val()),P=$.trim(l.val()),O=$.trim(u.val()),g=$.trim(s.val()),_=$.trim(f.val());if(!m)return d(i,"请输入收货人姓名。"),!1;if(OPPO.utils.strlen(m)>OPPO.utils.namelen)return d(i,"收货人姓名不能超过"+OPPO.utils.namelen+"个字符。"),!1;if(OPPO.utils.checkSpec(m))return d(i,"收货人姓名不能包含【 】 < > & * 这些特殊字符。"),!1;if(!p)return d(i,"请输入手机号码。"),!1;if(!OPPO.utils.isMobile(p))return d(i,"手机号码格式不正确。"),!1;if(!h||-1===parseInt(h))return d(i,"请选择您的收货地址。"),!1;if(!g)return d(i,"请输入详细地址。"),!1;if(OPPO.utils.checkSpec(g))return d(i,"详细地址不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(g)>OPPO.utils.addrlen)return d(i,"详细地址不能超过"+OPPO.utils.addrlen+"个字符。"),!1;if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0,OPPO.submit.change(t,"提交中"),g=OPPO.utils.filtertxt(g,o.find("option:selected").text()),g=OPPO.utils.filtertxt(g,c.find("option:selected").text()),g=OPPO.utils.filtertxt(g,l.find("option:selected").text()),g=OPPO.utils.filtertxt(g,u.find("option:selected").text());var k=OPPO.conf.BASE_URL+"/addresses/"+e,x={receiver:m,mobile:p,email:v?v:"",address:g,province_id:h,city_id:b,district_id:P,town_id:O,postcode:_};$.ajax({type:"PUT",url:k,data:x,success:function(e){if(!ajaxIsLogin(e))return!1;var a=parseInt(e.status,10);a>0?window.location.reload():(d(i,e.message),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(t,"保存"))},error:function(){d(i,"系统异常。"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(t,"保存")}})}),i.on("click",function(e){e.preventDefault();var t=$(this).attr("data-id"),i=$("[data-address-id="+t+"]");i.find(".form-actions").next(".alert-danger").remove(),i.hide();var a=i.next();a.show()}),r.on("click",function(e){e.preventDefault();var t="#address-create",i=$(t+" input[name=receiver]"),a=$(t+" input[name=mobile]"),n=$(t+" input[name=email]"),r=$(t+" input[name=address-detail]"),s=$(t+" input[name=postcode]");i.val(""),a.val(""),n.val(""),r.val(""),s.val(""),$(t+" .form-actions").next(".alert-danger").remove(),$("#address-create").region({pid:-1,cid:-1,did:-1,tid:-1}),$(t).parent().hide()}),s.click(function(){$("#address-create .form-actions").next(".alert-danger").remove(),o.toggle(),$("#address-create").region({pid:-1,cid:-1,did:-1,tid:-1})}),a.click(function(){var e="#address-create",t=$(e+" input[name=receiver]"),i=$(e+" input[name=mobile]"),n=$(e+" input[name=email]"),r=$(e+" input[name=address-detail]"),s=$(e+" select[name=province_id]"),o=$(e+" select[name=city_id]"),c=$(e+" select[name=district_id]"),l=$(e+" select[name=town_id]"),u=$(e+" input[name=postcode]"),f=$.trim(t.val()),m=$.trim(i.val()),p=$.trim(n.val()),v=$.trim(s.val()),h=$.trim(o.val()),b=$.trim(c.val()),P=$.trim(l.val()),O=$.trim(r.val()),g=$.trim(u.val());if(!f)return d(e,"请输入收货人姓名。"),!1;if(OPPO.utils.strlen(f)>OPPO.utils.namelen)return d(e,"收货人姓名不能超过"+OPPO.utils.namelen+"个字符。"),!1;if(OPPO.utils.checkSpec(f))return d(e,"收货人姓名不能包含【 】 < > & * 这些特殊字符。"),!1;if(!m)return d(e,"请输入手机号码。"),!1;if(!OPPO.utils.isMobile(m))return d(e,"手机号码格式不正确。"),!1;if(!v||-1===parseInt(v))return d(e,"请选择您的收货地址。"),!1;if(!O)return d(e,"请输入详细地址。"),!1;if(OPPO.utils.checkSpec(O))return d(e,"详细地址不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(O)>OPPO.utils.addrlen)return d(e,"详细地址不能超过"+OPPO.utils.addrlen+"个字符。"),!1;O=OPPO.utils.filtertxt(O,s.find("option:selected").text()),O=OPPO.utils.filtertxt(O,o.find("option:selected").text()),O=OPPO.utils.filtertxt(O,c.find("option:selected").text()),O=OPPO.utils.filtertxt(O,l.find("option:selected").text());var _={receiver:f,mobile:m,email:p?p:"",address:O,province_id:v,city_id:h,district_id:b,town_id:P,postcode:g};if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0,OPPO.submit.change(a,"提交中");var k=OPPO.conf.BASE_URL+"/addresses";$.post(k,_).success(function(t){if(!ajaxIsLogin(t))return!1;var i=parseInt(t.status,10);i>0?window.location.reload():(d(e,t.message),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(a,"保存"))}).error(function(){d(e,"系统异常。"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(a,"保存")})}),n.on("click",function(){n.hide(),$(".address-form-item").show()}),{edit:function(e){if(OPPO.submit.isSubmit)return!1;var t=$("[data-address-id="+e+"]");t.show(),t.find(".form-actions").next(".alert-danger").remove();var i=t.next();i.hide();var a=i.find(".address-form-receiver").val(),n=i.find(".address-form-mobile").val(),r=i.find(".address-form-email").val(),s=i.find(".address-form-address").val();$("#address-edit-"+e+" input[name=receiver]").val(a),$("#address-edit-"+e+" input[name=mobile]").val(n),$("#address-edit-"+e+" input[name=address-detail]").val(s),$("#address-edit-"+e+" input[name=email]").val(r);var o=$("#address-edit-"+e+" select[name=province_id]").data("region-default"),c=$("#address-edit-"+e+" select[name=city_id]").data("region-default"),d=$("#address-edit-"+e+" select[name=district_id]").data("region-default"),l=$("#address-edit-"+e+" select[name=town_id]").data("region-default");return $("#address-edit-"+e).region({pid:parseInt(o),cid:parseInt(c),did:parseInt(d),tid:parseInt(l)}),!1}}}}},OPPO.utils.isEmail=function(e){return e.match(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)},OPPO.utils.isMobile=function(e){return 11===e.length&&!isNaN(e)&&"1"===e.substring(0,1)},OPPO.utils.checkSpec=function(e){return e.match(/[\【\】\&\*\<\>]/)},OPPO.utils.updateCaptcha=function(){$("#captcha").attr("src",OPPO.conf.BASE_URL+"/captcha?"+Math.random())},OPPO.utils.strlen=function(e){var t=e.replace(/[^\x00-\xff]/g,"*");return t.length},OPPO.utils.namelen=20,OPPO.utils.addrlen=30,OPPO.utils.checkCoupon=function(e){return e.match(/^[A-Za-z0-9]{8,9}$/g)},OPPO.utils.filtertxt=function(e,t){return e.replace(t,"")},OPPO.utils.getcookie=function(e){if(!document.cookie.length>0)return"";for(var t=document.cookie.split(";"),i="",a=0;a<t.length;a++){var n=t[a].split("="),r=n[0].replace(/^\s+|\s+$/,"");r==e&&(i=n[1])}return i},OPPO.submit={isSubmit:!1,timer:null,counter:0,change:function(e,t){switch(e.addClass("button-submitting").html(t),OPPO.submit.counter++,OPPO.submit.counter%3){case 1:e.html(t+" 。");break;case 2:e.html(t+" 。。");break;default:e.html(t+" 。。。")}clearTimeout(OPPO.submit.timer),OPPO.submit.timer=setTimeout(function(){OPPO.submit.change(e,t)},1e3)},clearChange:function(e,t){OPPO.submit.counter=1,e.removeClass("button-submitting").html(t),clearTimeout(OPPO.submit.timer)}};